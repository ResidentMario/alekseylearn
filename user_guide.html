

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; fahr 0.0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Kaggle" href="drivers/kaggle.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> fahr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-workflow">The workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drivers/kaggle.html">Kaggle Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="drivers/sagemaker.html">SageMaker Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="fahr.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fahr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>Assuming you’ve read the <a class="reference external" href="https://residentmario.github.io/fahr/quickstart.html">Quickstart</a>, you now know how to run remote training jobs using the <code class="docutils literal notranslate"><span class="pre">fahr</span></code> command line. This section covers additional features and usage patterns useful for working with this tool.</p>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.residentmar.io/2019/02/23/data-science-experiments.html">Machine learning is an experimental discipline</a>, so it’s not obvious what an performant model will look like right away. You have to experiment with a lot of ideas (and potentially fumble with many of them) to get there.</p>
<p>Your earliest experiments should be simple baseline models that you can hopefully run locally. However, once you start digging into the model&amp;mdash;more layers, larger inputs, more epochs, hyperparameter tuning&amp;mdash;you will get to the point where the model can no longer be comfortably run on your local machine.</p>
<p>Once a long training job is running on your machine, you can’t really do anything else there because the training job is using up most of your compute resources.  It’s a better user experience if you can bundle the training job up, ship it off to some remote service somewhere, and get back to iterating on your ideas. You won’t know the result of the experiment until some number of minutes or hours later&amp;mdash;but that shouldn’t stop you from concurrently trying out other ideas as well while you wait for that one to finish.</p>
<p><code class="docutils literal notranslate"><span class="pre">fahr</span></code> lets you do that.</p>
</div>
<div class="section" id="the-workflow">
<h2>The workflow<a class="headerlink" href="#the-workflow" title="Permalink to this headline">¶</a></h2>
<p>I use the following simple but effective workflow. <a class="reference external" href="https://github.com/ResidentMario/progressive-resizing/blob/master/notebooks/build-models.ipynb">Also demonstrated here</a>. Note that this example uses the <a class="reference external" href="https://residentmario.github.io/fahr/drivers/sagemaker.html">SageMaker driver</a>, but all drivers are equally compatible.</p>
<p>This example uses AWS SageMaker, and requires you have configured your environment to work with AWS SageMaker (see the <a class="reference external" href="https://residentmario.github.io/fahr/drivers/sagemaker.html">Sagemaker driver</a> section), but other drivers are similar.</p>
<ol class="arabic">
<li><p class="first">Create a <code class="docutils literal notranslate"><span class="pre">models</span></code> folder in your repo.</p>
</li>
<li><p class="first">Create a folder for your first remote experiment, e.g. <code class="docutils literal notranslate"><span class="pre">resnet48_128</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">freeze</span> <span class="pre">&gt;</span> <span class="pre">requirements.txt</span></code> or <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">export</span> <span class="pre">--file</span> <span class="pre">environment.yml</span></code> to create a package dependencies manifest.</p>
</li>
<li><p class="first">Copy your training notebook (e.g. <code class="docutils literal notranslate"><span class="pre">model-dev.ipynb</span></code>) or script (e.g. <code class="docutils literal notranslate"><span class="pre">train.py</span></code>) to the folder. You may need to make some minor code adjustments to make it compatible with your training driver.</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">fahr</span> <span class="pre">init</span></code> to initialize the job assets:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr init train.py <span class="se">\</span>
    --train-driver<span class="o">=</span><span class="s1">&#39;sagemaker&#39;</span> <span class="se">\</span>
    --train-image<span class="o">=</span><span class="s1">&#39;default-gpu&#39;</span> <span class="se">\</span>
    --config.output_path<span class="o">=</span>s3://your-s3-bucket/path/ <span class="se">\</span>
    --config.role_name<span class="o">=</span>your-s3-role
</pre></div>
</div>
</div></blockquote>
<p>Note: if you are in an environment lacking a GPU, use <code class="docutils literal notranslate"><span class="pre">--build-driver='default-cpu'</span></code>.</p>
<p>You should now have two model training artifacts in your folder, a <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> and a <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> entrypoint, which you may optionally edit.</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">fahr</span> <span class="pre">fit</span></code> and launch the job:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr fit train.py <span class="se">\</span>
    --train-driver<span class="o">=</span><span class="s1">&#39;sagemaker&#39;</span> <span class="se">\</span>
    --build-driver<span class="o">=</span><span class="s1">&#39;local-gpu&#39;</span> <span class="se">\</span>
    --config.output_path<span class="o">=</span>s3://your-s3-bucket/path/ <span class="se">\</span>
    --config.role_name<span class="o">=</span>your-s3-role
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>You will get a message to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> once the job is running explaining where to go to track it.</p>
<p>For jobs after the first one, you can use the handy <code class="docutils literal notranslate"><span class="pre">copy</span></code> method to move any files you need over:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr copy ../resnet48_128/ ./ <span class="se">\</span>
    --include-training-artifact<span class="o">=</span><span class="s1">&#39;train.py&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>One of the great things about this workflow is that it makes it easy to brute-force model hyperparameter search. For example, to find the optimal <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> parameter for the model in the demo repo I didn’t bother writing additional code to perform a grid search&amp;mdash;I just launched three jobs concurrently, one each at 512, 256, and 128 samples per batch.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="drivers/kaggle.html" class="btn btn-neutral float-right" title="Kaggle" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Aleksey Bilogur

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
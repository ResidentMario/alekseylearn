

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; fahr 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Kaggle" href="drivers/kaggle.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> fahr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-workflow">The workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drivers/kaggle.html">Kaggle Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="drivers/sagemaker.html">SageMaker Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="fahr.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">fahr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>Assuming you’ve read the <a class="reference external" href="https://residentmario.github.io/fahr/quickstart.html">Quickstart</a>, you now know how to run remote training jobs using the <code class="docutils literal notranslate"><span class="pre">fahr</span></code> command line. This section covers additional features and usage patterns useful for working with this tool.</p>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/ResidentMario/progressive-resizing">progressive resizing</a> repo demonstrates a good pattern for using <code class="docutils literal notranslate"><span class="pre">fahr</span></code>, and it’s the example I will use throughout this section of the documentation.</p>
<p><a class="reference external" href="https://www.residentmar.io/2019/02/23/data-science-experiments.html">Machine learning is an experimental discipline</a>, so it’s not obvious what an performant model will look like right away. You have to experiment with a lot of ideas (and potentially fumble with many of them) to get there.</p>
<p>Your earliest experiments should be simple baseline models that you can hopefully run locally. However, once you start digging into the model - more layers, more complex loss functions, longer training cycles, advanced hyperparameter tuning - the complexity of the model will start to exceed your ability to train it locally without long waiting times.</p>
<p>Using a powerful cloud Jupyter environment like AWS SageMaker Notebooks will buy you time, but with a sufficiently complex model you <em>will</em> get the to the point where your model takes an hour or more to train. And once a long training job is running in your notebook, you can’t really do anything else there because it’s waiting for your training job to finish. If you start working on your models in a separate notebook that not only breaks up your flow but also, if you’re still on the same instance, gets in the way of your training job, which is (hopefully) using up most of your compute resources.</p>
<p>It’s a better user experience if you can bundle up your current training job, ship it off to some remote service somewhere, and get back to iterating on your ideas. You won’t know whether the particular idea you’re experimenting with is “good” or not until that hour passes and you get back a result, but that shouldn’t stop you from concurrently trying out other ideas as well while you wait for that one to finish.</p>
<p><code class="docutils literal notranslate"><span class="pre">fahr</span></code> lets you do that.</p>
</div>
<div class="section" id="the-workflow">
<h2>The workflow<a class="headerlink" href="#the-workflow" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">build-models.ipynb</span></code> notebook in the demo repo demonstrates the workflow. <a class="reference external" href="https://github.com/ResidentMario/progressive-resizing/blob/master/notebooks/build-models.ipynb">Open it yourself</a> to follow along.</p>
<p>The first time you want to run a remote training job you will need to create some resources:</p>
<ol class="arabic">
<li><p class="first">Once your models get too complex to train comfortably locally, create a <code class="docutils literal notranslate"><span class="pre">models</span></code> folder in your repo.</p>
</li>
<li><p class="first">Create a folder for your first remotely-trained experiment: in <code class="docutils literal notranslate"><span class="pre">progressive-resizing</span></code> this was a model I named <code class="docutils literal notranslate"><span class="pre">resnet48_128</span></code>.</p>
</li>
<li><p class="first">Add a <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file to the folder that documents the packages required for your model traning jobs to run (<code class="docutils literal notranslate"><span class="pre">keras</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, etcetera).</p>
</li>
<li><p class="first">Create a model training artifact: a <code class="docutils literal notranslate"><span class="pre">train.py</span></code> or <code class="docutils literal notranslate"><span class="pre">train.ipynb</span></code> file that defines the training regimen.</p>
</li>
<li><p class="first">Go into the model folder and run <code class="docutils literal notranslate"><span class="pre">fahr</span> <span class="pre">init</span></code>:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr init train.py <span class="se">\</span>
    --train-driver<span class="o">=</span><span class="s1">&#39;sagemaker&#39;</span> <span class="se">\</span>
    --build-driver<span class="o">=</span><span class="s1">&#39;local-gpu&#39;</span> <span class="se">\</span>
    --config.output_path<span class="o">=</span><span class="nv">$S3_ARTIFACT_DIRECTORY</span> <span class="se">\</span>
    --config.role_name<span class="o">=</span><span class="nv">$EXECUTION_ROLE_NAME</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">You should now have some model training artifacts in your folder. In all non-<code class="docutils literal notranslate"><span class="pre">kaggle</span></code> cases this will be a <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> compatible with your training driver and a <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> script that acts as the entrypoint to that image. You can edit these to your liking. For exampe, in the demo repo I added some commands to download the dataset to <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> (<a class="reference external" href="https://github.com/ResidentMario/progressive-resizing/blob/master/resnet48_128/run.sh">see here</a>).</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">fahr</span> <span class="pre">fit</span></code> and launch the job:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr fit train.py <span class="se">\</span>
    --train-driver<span class="o">=</span><span class="s1">&#39;sagemaker&#39;</span> <span class="se">\</span>
    --build-driver<span class="o">=</span><span class="s1">&#39;local-gpu&#39;</span> <span class="se">\</span>
    --config.output_path<span class="o">=</span><span class="nv">$S3_ARTIFACT_DIRECTORY</span> <span class="se">\</span>
    --config.role_name<span class="o">=</span><span class="nv">$EXECUTION_ROLE_NAME</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>The process for every run after the first is similar, but simpler:</p>
<ol class="arabic">
<li><p class="first">Create a new folder for the experiment.</p>
</li>
<li><p class="first">Copy the files over:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ fahr copy ../resnet48_128/ ./ <span class="se">\</span>
    --include-training-artifact<span class="o">=</span><span class="s1">&#39;train.py&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Edit as necessary - add or remote packages from the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, update environment variables in the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>, etcetera.</p>
</li>
<li><p class="first">Run <code class="docutils literal notranslate"><span class="pre">fahr</span> <span class="pre">fit</span></code> again to launch the new job.</p>
</li>
</ol>
<p>One of the great things about this workflow is that it makes it easy to brute-force model hyperparameter search. When I was trying to find the optimal <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> in the demo repo, I didn’t bother writing additional code to perform a grid search, I just launched three jobs concurrently, one each at 512, 256, and 128 samples per batch.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="drivers/kaggle.html" class="btn btn-neutral float-right" title="Kaggle" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Aleksey Bilogur

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>